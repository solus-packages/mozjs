From 93e902a00f42423160c985b48399823457aa234a Mon Sep 17 00:00:00 2001
From: Joshua Strobl <joshua@stroblindustries.com>
Date: Sat, 13 Apr 2019 18:24:22 +0300
Subject: [PATCH 1/1] Fix sonames

---
 js/src/build/Makefile.in | 2 ++
 js/src/build/moz.build   | 1 +
 2 files changed, 3 insertions(+)

diff --git a/js/src/build/Makefile.in b/js/src/build/Makefile.in
index ee19104e0..a0f06fd35 100644
--- a/js/src/build/Makefile.in
+++ b/js/src/build/Makefile.in
@@ -89,6 +89,8 @@ ifneq (,$(REAL_LIBRARY))
 endif
 ifneq (,$(SHARED_LIBRARY))
 	$(SYSINSTALL) $(SHARED_LIBRARY) $(DESTDIR)$(libdir)
+	mv -f $(DESTDIR)$(libdir)/$(SHARED_LIBRARY) $(DESTDIR)$(libdir)/$(SHARED_LIBRARY).0
+	ln -s $(SHARED_LIBRARY).0 $(DESTDIR)$(libdir)/$(SHARED_LIBRARY)
 ifeq ($(OS_ARCH),Darwin)
 	install_name_tool -id $(abspath $(libdir)/$(SHARED_LIBRARY)) $(DESTDIR)$(libdir)/$(SHARED_LIBRARY)
 endif
diff --git a/js/src/build/moz.build b/js/src/build/moz.build
index a7f5fa4ce..726687c13 100644
--- a/js/src/build/moz.build
+++ b/js/src/build/moz.build
@@ -23,6 +23,7 @@ if not CONFIG['JS_STANDALONE']:
 if CONFIG['JS_SHARED_LIBRARY']:
     GeckoSharedLibrary('js', linkage=None)
     SHARED_LIBRARY_NAME = CONFIG['JS_LIBRARY_NAME']
+    LDFLAGS += ['-Wl,-soname,lib{}.so.0'.format(SHARED_LIBRARY_NAME)]
 else:
     Library('js')
 
-- 
2.21.0

