name       : mozjs
version    : 52.7.3
release    : 6
source     :
    - https://ftp.mozilla.org/pub/firefox/releases/52.7.3esr/source/firefox-52.7.3esr.source.tar.xz : 5cc68c1a7486cfbbf02aec0e9da9f87b55e7bfc68c7d5139bc1e578441aaf19f
homepage   : http://mozilla.org
license    :
    - GPL-2.0
    - MPL-1.1
component  : desktop.library
summary    : JS is Mozilla's JavaScript engine written in C/C++
description: |
    JS is Mozilla's JavaScript engine written in C/C++
builddeps  :
    - pkgconfig(nspr)
    - autoconf213
setup      : |
    export PYTHON=/usr/bin/python2
    %apply_patches
    head -n -1 config/milestone.txt > config/milestone.txt
    echo "${version}" >> config/milestone.txt
    cd $workdir/js/src
    autoconf213
    %configure --enable-readline \
               --enable-threadsafe \
               --enable-shared-js \
               --with-system-nspr
build      : |
    export PYTHON=/usr/bin/python2
    cd $workdir/js/src
    %make
install    : |
    export PYTHON=/usr/bin/python2
    cd $workdir/js/src
    %make_install
    rm -r $installdir/%libdir%/*.ajs

    # Restore proper versioning and rely on soname only
    mv $installdir/%libdir%/libmozjs-52.so $installdir/%libdir%/libmozjs-52.so.0
    ln -s libmozjs-52.so.0 $installdir/%libdir%/libmozjs-52.so
